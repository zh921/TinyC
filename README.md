# TinyC

Write your own compiler.

https://pandolia.net/tinyc/

https://www.bookstack.cn/books/pandolia-tinyc

自己动手写编译器

## ch1 概述

编译器是将一种程序（源程序）翻译成另一种程序（目标程序）的计算机程序。本书介绍一个非常简单的编译器（ TinyC 编译器）的实现。

TinyC 编译器可将 TinyC 源程序编译成 Linux 下的可执行程序，其编译及运行基本流程如下图，首先利用 TinyC 前端将 TinyC 源程序编译成中间代码 Pcode ，再利用 Nasm 的宏程序将 Pcode 翻译成 x86（32位） 汇编指令，然后利用 Nasm 汇编成二进制目标程序，最后链接成 Linux 下的 32 位可执行程序，可直接在 Linux 下运行。另外，中间代码 Pcode 也可以用 Pcode 模拟器直接运行。

![1.1-TinyC编译及运行基本流程.png](./assets/1.1-TinyC编译及运行基本流程.png)

上图中绿色部分的 TinyC 前端、 Nasm 宏以及 Pcode 模拟器为由本人编程实现的部分，其他则是利用了 Nasm 和 ld 来生成可执行的二进制机器码。本书将 Nasm 宏、 Nasm 汇编器、 ld 链接器一起称为 TinyC 后端，将 TinyC 前端和 TinyC 后端一起称为 TinyC 编译器。

## ch2 源程序 TinyC

TinyC文件：

    TinyC\tinyc\test.c

命令:

    gcc -o tinyc tinyc.c
    ./tinyc

## ch4 中间代码 Pcode

Pcode 模拟器是用 python 编写的用来运行 Pcode 的程序：

    TinyC\tinyc\sources\pysim.py

命令:

    python2 pysim.py pcode_1.asm

输出：

    a = 3, b = 6

单步执行命令：

    python2 pysim.py pcode_1.asm -d

## ch5 手工编译 TinyC

命令:

    python2 pysim.py factor.asm -a

单步执行命令：

    python2 pysim.py factor.asm -da

## ch6 编译器基本流程

#### 什么是编译器，为什么要开发编译器？

编译器是将一种程序语言（源程序：source language）翻译为另一种程序语言（目标程序：target language）的计算机程序。一般来说，源程序为高级语言，而目标语言则是汇编语言或机器码。

早期的计算机程序员们用机器码写程序，编程十分耗时耗力，也非常容易出错，很快程序员们发明了汇编语言，提高了编程的速度和准确度，但编写起来还是不容易，且程序严格依赖于特定的机器，很难移植和重复利用。

上世纪50～60年代，第一批高级语言及编译器被开发出来，程序的文法非常接近于数学公式以及自然语言，使得编写、阅读和维护程序的难度大为降低，程序编制的速度、规模和稳定性都有了质的飞跃。

可以说是编译器的产生带来了计算机行业的飞跃发展，所以开发编译器是非常有必要的。

#### 编译器的工作流程

先让我们回忆一下我们在上一章中是如何手工将源程序翻译成中间代码的，想一想翻译的第一步是什么？第一步是我们的人脑要理解源程序，理解源程序的结构，理解源程序的含义、作用，然后才能根据我们的理解进行翻译。

要让计算机将源程序翻译成目标程序，我们也要让计算机真正的理解源程序，让计算机分析出源程序的结构，将源程序由一串无意义的字符流解析为一个个的有特定含义的构件，将这些构件进行转换后，再按特定的规则和顺序将转换后的构件拼装成目标程序。

编译器的工作流程见下图：

![6.1-编译器工作流程.png](./assets/6.1-编译器工作流程.png)

编译器的工作流程简要描述如下：

    1. 对源文件进行扫描，将源文件的字符流拆分分一个个的词（记号），此为词法分析
    2. 根据语法规则将这些记号构造出语法树，此为语法分析
    3. 对语法树的各个节点之间的关系进行检查，检查语义规则是否被违背，同时对语法树进行必要的优化，此为语义分析
    4. 遍历语法树的节点，将各节点转化为中间代码，并按特定的顺序拼装起来，此为中间代码生成
    5. 对中间代码进行优化
    6. 将中间代码转化为目标代码
    7. 对目标代码进行优化，生成最终的目标程序

## ch7 词法分析

## ch8 用flex做词法分析

flex 是一个快速词法分析生成器，它可以将用户用正则表达式写的分词匹配模式构造成一个有限状态自动机（一个C函数），目前很多编译器都采用它来生成词法分析器。flex 的主页：http://flex.sourceforge.net/ 。

## ch9 上下文无关语法及分析
















